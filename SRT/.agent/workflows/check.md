---
description: SRT 檔案品質檢查與修正 (QA/QC)
---

# /check - SRT 檔案品質檢查與修正

## 📚 規範參考（文件階層）

| 層級         | 文件                    | 用途                         |
| ------------ | ----------------------- | ---------------------------- |
| 🔴 **決策層** | `Agent.md` 第 93-112 行 | 核心鐵律、任務定義、修正流程 |
| 🟡 **參考層** | `SRT_QA_QC_檢查清單.md` | 完整標準、邊緣案例判斷依據   |
| 🟢 **執行層** | 本文件 (`check.md`)     | Agent 自動化工作流程指令     |

> ⚠️ **優先順序**：遇到衝突時，以 `Agent.md` 為準。
> 
> 📖 **邊緣案例**：如遇本文件未涵蓋的情況（如毫秒進位、座標格式），請查閱 `SRT_QA_QC_檢查清單.md`。

---

此工作流程對 SRT 字幕檔進行格式檢查與時間軸修正。

## 前置作業

// turbo
1. 閱讀專案規範 `Agent.md` 確認任務二的規範要求：
   ```bash
   cat Agent.md | sed -n '93,124p'
   ```

2. 確認目標 SRT 檔案：
   - 詢問用戶要檢查哪個 SRT 檔案
   - 若未指定，列出當前目錄所有 `.srt` 檔案供用戶選擇

// turbo
3. 列出可用 SRT 檔案：
   ```bash
   ls -la *.srt 2>/dev/null || echo "目前目錄無 SRT 檔案"
   ```

## 檢查項目

4. **讀取 SRT 檔案**
   - 使用 `view_file` 工具讀取檔案內容
   - ⚠️ 每個檔案視為獨立任務，清除前次記憶

5. **格式檢查 (Format Inspection)**
   檢查以下項目並記錄問題：

   | 檢查項目     | 正確格式                        | 常見錯誤                      |
   | ------------ | ------------------------------- | ----------------------------- |
   | 序號         | 純數字 (1, 2, 3...)             | 包含非數字字符                |
   | 時間軸格式   | `HH:MM:SS,mmm --> HH:MM:SS,mmm` | 缺少毫秒、格式不正確          |
   | 時間軸邏輯   | Start < End                     | Start >= End                  |
   | 時間軸連續性 | Next Start >= Previous End      | 時間重疊或跳躍                |
   | 分鐘循環     | 正確遞增                        | 00:59:00 -> 00:00:00 錯誤重置 |
   | 髒字符       | 無                              | `ms`, `周4` 等異常字符        |

6. **產出檢查報告**
   ```
   📋 SRT 品質檢查報告
   
   檔案：[filename.srt]
   檢查時間：[timestamp]
   
   ✅ 通過項目：
   - [列出通過的檢查項目]
   
   ❌ 發現問題：
   - 行 XX：[問題描述]
   - 行 XX：[問題描述]
   
   📊 統計：
   - 總字幕數：XXX
   - 問題數量：X
   ```

## 修正流程

7. **若發現問題，詢問用戶是否執行修正**

8. **修正步驟 (依據 Agent.md 規範)**

   a. **清理 (Clean)**
      - 提取 `[\d:,]` 純數字與分隔符
      - 過濾髒字符（如 `ms`, `周4`）

   b. **正規化 (Normalize)**
      - 補齊為 `HH:MM:SS,mmm` 格式
      - 毫秒補足 3 位

   c. **邏輯修復**
      - 修正分鐘循環錯誤（00:59:00 -> 00:00:00）
      - 確保 `Start Time < End Time`
      - 確保 `Next Start >= Previous End`

9. **輸出修正後檔案**
   - 命名為 `[原檔名]_fixed.srt`
   - ⚠️ **嚴禁覆寫原始 SRT**
   - 編碼：UTF-8

## 🛑 禁止行為

- ❌ 修改字幕文字內容
- ❌ 覆寫原始 SRT 檔案
- ❌ 跨檔案記憶（每檔獨立處理）

## 回報格式

### 僅檢查（無修正）
```
📋 SRT 品質檢查完成

檔案：[filename.srt]
狀態：✅ 無問題 / ⚠️ 發現 X 個問題

[詳細檢查報告]
```

### 檢查並修正
```
✅ SRT 修正完成

📁 原始檔案：[filename.srt]（已保留）
📄 修正檔案：[filename_fixed.srt]

🔧 修正項目：
- [列出修正內容]

📊 統計：
- 修正前問題數：X
- 修正後問題數：0
```

## 進階選項

用戶可附加參數：
- `/check --all`：檢查目錄下所有 SRT 檔案
- `/check --fix`：檢查並自動修正（需確認）
- `/check filename.srt`：指定特定檔案
